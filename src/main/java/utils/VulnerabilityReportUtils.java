package utils;

import org.apache.poi.EncryptedDocumentException;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import valueobjects.RowIndex;
import valueobjects.VRow;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.stream.Stream;
import java.util.Arrays;
import utils.ExcelReaderUtil;

/**
 * Created by tsomal on 2/23/21.
 */
public class VulnerabilityReportUtils {



    public static void main(String args[]) throws EncryptedDocumentException, IOException {
        //extractMyVulnerabilities("FeatureTrackerMaster.xlsx", "Tarun");
        Map<String, List<VRow>>  myFeatures = getMyFeatures();
        Map<String, List<VRow>>  myVulnerabilities = getMyVulnerabilities();

        System.out.println(myVulnerabilities);

    }

    private static Map<String, List<VRow>>  getMyFeatures() throws IOException {

        Workbook wb = ExcelReaderUtil.getWorkBook( "FeatureTrackerMaster.xlsx");
        Sheet s = ExcelReaderUtil.getSheet(wb, "MASTER");
        List<VRow> allMasterMappingRows = ExcelReaderUtil.getAllRowsFromMasterMapper(s);


        Map<String, List<VRow>> filtered = VRowUtils.mapByProductOwer(allMasterMappingRows, "Sid");
        System.out.println(filtered);
        wb.close();
        return filtered;

    }

    public static Map<String, List<VRow>> getMyVulnerabilities() throws IOException{


        Workbook wbV = ExcelReaderUtil.getWorkBook( "Vulnerabilities.xlsx");
        Sheet sV = ExcelReaderUtil.getSheet(wbV, "Vulnerability");
        List<VRow> alVulnerabilitiesRows = ExcelReaderUtil.getAllRowsFromVulnerabilitySheet(sV);
        Map<String, List<VRow>> filteredV = VRowUtils.mapByProductOwer(alVulnerabilitiesRows, "Tarun");
        wbV.close();
        return filteredV;

    }
}
